
â¸»

ğŸ“ GitHub Repo Structure: SOC-Automation-AWS

SOC-Automation-AWS/
â”‚
â”œâ”€â”€ README.md                 â† Project summary, overview, and workflow diagram
â”œâ”€â”€ instructions.md           â† Full step-by-step deployment guide (detailed below)
â”œâ”€â”€ what-it-does.md           â† Technical explanation of how the full pipeline functions
â”œâ”€â”€ architecture.png          â† Diagram of the infrastructure (optional but recommended)
â”œâ”€â”€ wazuh/
â”‚   â”œâ”€â”€ ossec.conf            â† Sample Wazuh config with Shuffle integration
â”‚   â””â”€â”€ active-response.xml   â† Example AR rule for IP blocking
â”‚
â”œâ”€â”€ shuffle/
â”‚   â”œâ”€â”€ workflow.json         â† Exported Shuffle workflow
â”‚   â””â”€â”€ virus-total-fix.md    â† Instructions for patching the VT API call
â”‚
â”œâ”€â”€ thehive/
â”‚   â””â”€â”€ hive-setup.md         â† Setup, API key generation, permissions
â”‚
â””â”€â”€ screenshots/
    â””â”€â”€ *.png                 â† Key screenshots of Wazuh, Shuffle, TheHive, and email alerts


â¸»

ğŸ“˜ instructions.md â€“ Step-by-Step Deployment

1. Cloud Environment Setup (AWS)
	â€¢	Launch EC2 instance for Wazuh:
	â€¢	OS: Ubuntu 22.04 LTS
	â€¢	Type: t2.medium (Free tier OK if new)
	â€¢	Open ports:
	â€¢	22 (SSH)
	â€¢	443 (Wazuh dashboard)
	â€¢	1514 (TCP for agent communication)
	â€¢	55000 (Wazuh API)
	â€¢	Launch second EC2 instance for TheHive (Ubuntu) and open port 9000

â¸»

2. Wazuh Installation

curl -sO https://packages.wazuh.com/4.6/wazuh-install.sh
sudo bash wazuh-install.sh -a --ignore-check

	â€¢	Wait ~10â€“15 mins for installation
	â€¢	Login to Wazuh dashboard at https://<EC2-IP> with provided admin password

â¸»

3. Windows VM Setup (VirtualBox)
	â€¢	Download Windows 10 ISO and install in VirtualBox
	â€¢	Install Sysmon
	â€¢	Download and install Wazuh agent
	â€¢	Configure ossec.conf on the VM:

<server>
  <address>your-wazuh-ec2-ip</address>
  <port>1514</port>
  <protocol>tcp</protocol>
</server>

	â€¢	Restart agent from services.msc

â¸»

4. Shuffle Setup
	â€¢	Go to https://shuffler.io
	â€¢	Create a new workflow:
	â€¢	Trigger: Webhook
	â€¢	Steps:
	â€¢	Regex (extract hash)
	â€¢	VirusTotal (API key required)
	â€¢	TheHive (alert creation)
	â€¢	Email node (send alert)
	â€¢	(Optional) HTTP + Wazuh API for active response
	â€¢	Copy webhook URL from Shuffle and insert into your Wazuh ossec.conf:

<integration>
  <name>custom</name>
  <hook_url>https://app.shuffler.io/trigger/your-webhook</hook_url>
  <rule_id>100002</rule_id> <!-- Customize this -->
</integration>

	â€¢	Restart Wazuh Manager

â¸»

5. VirusTotal Integration
	â€¢	Sign up at https://www.virustotal.com
	â€¢	Get your API key and paste it into Shuffle app
	â€¢	Fix endpoint:
	â€¢	VTâ€™s new API expects:

https://www.virustotal.com/api/v3/files/{id}


	â€¢	Modify Shuffleâ€™s VirusTotal app to match this if necessary

â¸»

6. TheHive Setup
	â€¢	SSH into Hive EC2 and install TheHive (use thehive-project.org docs)
	â€¢	Default login:
	â€¢	admin@thehive.local / secret
	â€¢	Create new organization (e.g., mydfir)
	â€¢	Add:
	â€¢	Analyst user (login + password)
	â€¢	Service account for Shuffle (generate API key)

â¸»

7. Connecting Shuffle to TheHive
	â€¢	In Shuffle:
	â€¢	Add TheHive app
	â€¢	Paste your Hive API key
	â€¢	Use action: create alert
	â€¢	Provide dynamic fields:
	â€¢	title, summary, description
	â€¢	computer, user, timestamp

â¸»

8. Email Integration (Optional)
	â€¢	Use disposable emails (e.g., SquareX)
	â€¢	Add Email app in Shuffle
	â€¢	Trigger alerts to analysts with:
	â€¢	Hostname
	â€¢	SHA-256 hash
	â€¢	Detection summary

â¸»

9. Active Response (Optional Linux Integration)
	â€¢	Add <active-response> config in Wazuh:

<active-response>
  <command>firewalldrop</command>
  <location>local</location>
  <level>7</level>
  <timeout>0</timeout>
</active-response>

	â€¢	Add Wazuh API HTTP node in Shuffle
	â€¢	Send commands via firewalldrop0 to dynamically block IPs using iptables

â¸»

10. Testing It All
	â€¢	Trigger Mimikatz or custom detection rule on Windows VM
	â€¢	Wazuh â†’ Shuffle â†’ VirusTotal â†’ TheHive â†’ Email
	â€¢	Test â€œblockâ€ response â†’ confirm IP added to iptables on Ubuntu agent

â¸»
